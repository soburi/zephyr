/*
 * Copyright (c) 2018 PHYTEC Messtechnik GmbH
 * Copyright (c) 2024 TOKITA Hiroshi
 *
 * SPDX-License-Identifier: Apache-2.0
 */

/**
 * @file
 * @brief Public Monochrome Character Framebuffer API
 */

#ifndef __CFB_H__
#define __CFB_H__

#include <zephyr/device.h>
#include <zephyr/drivers/display.h>
#include <zephyr/sys/iterable_sections.h>
#include <zephyr/sys/slist.h>

#ifdef __cplusplus
extern "C" {
#endif

/**
 * @brief Public Monochrome Character Framebuffer API
 * @defgroup monochrome_character_framebuffer Monochrome Character Framebuffer
 * @ingroup utilities
 * @{
 */

/**
 * @brief Macro for creating a font entry.
 *
 * @param _name   Name of the font entry.
 * @param _width  Width of the font in pixels
 * @param _height Height of the font in pixels.
 * @param _caps   Font capabilities.
 * @param _data   Raw data of the font.
 * @param _fc     Character mapped to first font element.
 * @param _lc     Character mapped to last font element.
 */
#define FONT_ENTRY_DEFINE(_name, _width, _height, _caps, _data, _fc, _lc)                          \
	static const STRUCT_SECTION_ITERABLE(cfb_font, _name) = {                                  \
		.data = _data,                                                                     \
		.caps = _caps,                                                                     \
		.width = _width,                                                                   \
		.height = _height,                                                                 \
		.first_char = _fc,                                                                 \
		.last_char = _lc,                                                                  \
	}

/**
 * @brief Initializer macro for draw-point operation
 *
 * @param pos Position of the point
 */
#define CFB_OP_INIT_DRAW_POINT(str, pos)                                                           \
	{                                                                                          \
		.param = {                                                                         \
			.op = CFB_OP_DRAW_POINT,                                                   \
			.draw_figure =                                                             \
				{                                                                  \
					.start = pos,                                              \
				},                                                                 \
		},                                                                                 \
	}

/**
 * @brief Initializer macro for draw-line operation
 *
 * @param start Start position of the line
 * @param end End position of the line
 */
#define CFB_OP_INIT_DRAW_LINE(str, s, e)                                                           \
	{                                                                                          \
		.param = {                                                                         \
			.op = CFB_OP_DRAW_LINE,                                                    \
			.draw_figure =                                                             \
				{                                                                  \
					.start = s,                                                \
					.end = e,                                                  \
				},                                                                 \
		},                                                                                 \
	}

/**
 * @brief Initializer macro for draw-rect operation
 *
 * @param start Top-Left position of the rectangle
 * @param end Bottom-Right position of the rectangle
 */
#define CFB_OP_INIT_DRAW_RECT(str, s, e)                                                           \
	{                                                                                          \
		.param = {                                                                         \
			.op = CFB_OP_DRAW_RECT,                                                    \
			.draw_figure =                                                             \
				{                                                                  \
					.start = s,                                                \
					.end = e,                                                  \
				},                                                                 \
		},                                                                                 \
	}

/**
 * @brief Initializer macro for draw-text operation
 *
 * @param str String to print
 * @param x Position in X direction of the beginning of the strings
 * @param y Position in Y direction of the beginning of the strings
 */
#define CFB_OP_INIT_DRAW_TEXT(strings, x, y)                                                       \
	{                                                                                          \
		.param = {                                                                         \
			.op = CFB_OP_DRAW_TEXT,                                                    \
			.draw_text =                                                               \
				{                                                                  \
					.pos = {x, y},                                             \
					.str = strings,                                            \
				},                                                                 \
		},                                                                                 \
	}

/**
 * @brief Initializer macro for print operation
 *
 * @param str String to print
 * @param x Position in X direction of the beginning of the strings
 * @param y Position in Y direction of the beginning of the strings
 */
#define CFB_OP_INIT_PRINT(strings, x, y)                                                           \
	{                                                                                          \
		.param = {                                                                         \
			.op = CFB_OP_PRINT,                                                        \
			.draw_text =                                                               \
				{                                                                  \
					.pos = {x, y},                                             \
					.str = strings,                                            \
				},                                                                 \
		},                                                                                 \
	}

/**
 * @brief Initializer macro for draw-text-ref operation
 *
 * @param str String to print
 * @param x Position in X direction of the beginning of the strings
 * @param y Position in Y direction of the beginning of the strings
 */
#define CFB_OP_INIT_DRAW_TEXT_REF(strings, x, y)                                                   \
	{                                                                                          \
		.param = {                                                                         \
			.op = CFB_OP_DRAW_TEXT_REF,                                                \
			.draw_text =                                                               \
				{                                                                  \
					.pos = {x, y},                                             \
					.str = strings,                                            \
				},                                                                 \
		},                                                                                 \
	}

/**
 * @brief Initializer macro for print-ref operation
 *
 * @param str String to print
 * @param x Position in X direction of the beginning of the strings
 * @param y Position in Y direction of the beginning of the strings
 */
#define CFB_OP_INIT_PRINT_REF(strings, x, y)                                                       \
	{                                                                                          \
		.param = {                                                                         \
			.op = CFB_OP_PRINT_REF,                                                    \
			.draw_text =                                                               \
				{                                                                  \
					.pos = {x, y},                                             \
					.str = strings,                                            \
				},                                                                 \
		},                                                                                 \
	}

/**
 * @brief Initializer macro for invert-area operation
 *
 * @param xpos Position in X direction of the beginning of area
 * @param ypos Position in Y direction of the beginning of area
 * @param width Width of area in pixels
 * @param height Height of area in pixels
 *
 */
#define CFB_OP_INIT_INVERT_AREA(xpos, ypos, width, height)                                         \
	{                                                                                          \
		.param = {                                                                         \
			.op = CFB_OP_INVERT_AREA,                                                  \
			.invert_area =                                                             \
				{                                                                  \
					.x = xpos,                                                 \
					.y = ypos,                                                 \
					.w = width,                                                \
					.h = height,                                               \
				},                                                                 \
		},                                                                                 \
	}

/**
 * @brief Initializer macro for set-font operation
 *
 * @param idx Font index
 */
#define CFB_OP_INIT_SET_FONT(idx)                                                                  \
	{                                                                                          \
		.param = {                                                                         \
			.op = CFB_OP_SET_FONT,                                                     \
			.set_font =                                                                \
				{                                                                  \
					.font_idx = idx,                                           \
				},                                                                 \
		},                                                                                 \
	}

/**
 * @brief Initializer macro for set-kerning operation
 *
 * @param kerning Spacing between each characters in pixels
 */
#define CFB_OP_INIT_SET_KERNING(kern)                                                              \
	{                                                                                          \
		.param = {                                                                         \
			.op = CFB_OP_SET_KERNING,                                                  \
			.set_kerning =                                                             \
				{                                                                  \
					.kerning = kern,                                           \
				},                                                                 \
		},                                                                                 \
	}

#define CFB_OP_INIT_INVERT()                                                                       \
	{                                                                                          \
		.param = {                                                                         \
			.op = CFB_OP_INVERT,                                                       \
		},                                                                                 \
	}

/**
 * @brief Initializer macro for set command buffer operation
 */
#define CFB_OP_INIT_COMMAND_BUFFER(cbuf)                                                           \
	{                                                                                          \
		.param = {                                                                         \
			.op = CFB_OP_SET_COMMAND_BUFFER,                                           \
			.cmd_buffer =                                                              \
				{                                                                  \
					.cmd_buf = cbuf,                                           \
				},                                                                 \
		},                                                                                 \
	}

enum cfb_display_param {
	CFB_DISPLAY_HEIGH		= 0,
	CFB_DISPLAY_WIDTH,
	CFB_DISPLAY_PPT,
	CFB_DISPLAY_ROWS,
	CFB_DISPLAY_COLS,
};

enum cfb_font_caps {
	CFB_FONT_MONO_VPACKED		= BIT(0),
	CFB_FONT_MONO_HPACKED		= BIT(1),
	CFB_FONT_MSB_FIRST		= BIT(2),
};

/**
 * @brief CFB operation types.
 */
enum cfb_operation {
	CFB_OP_NOP = 0x0,
	/** Inverts foreground and backgroud colors */
	CFB_OP_INVERT,
	/** Inverts the color of the specified area */
	CFB_OP_INVERT_AREA,
	/** Draw a point */
	CFB_OP_DRAW_POINT,
	/** Draw a line */
	CFB_OP_DRAW_LINE,
	/** Draw a rectangle */
	CFB_OP_DRAW_RECT,
	/** Draw a text */
	CFB_OP_DRAW_TEXT,
	/** Print a text */
	CFB_OP_PRINT,
	/** Draw a text specified by reference */
	CFB_OP_DRAW_TEXT_REF,
	/** Print a text specified by reference */
	CFB_OP_PRINT_REF,
	/** Set font for text rendering */
	CFB_OP_SET_FONT,
	/** Set kerning for text rendering */
	CFB_OP_SET_KERNING,
	/** Set inverted state */
	CFB_OP_SET_INVERTED,
	/** Add command buffer */
	CFB_OP_SET_COMMAND_BUFFER,
	/**
	 * Fills the drawing surface with the background color.
	 * This is internal operation. Don't use it.
	 */
	CFB_OP_FILL = 0xFE,
	CFB_OP_TERMINATE = 0xFF,
};

enum init_commands {
	CFB_INIT_CMD_SET_FONT,
	CFB_INIT_CMD_SET_KERNING,
	CFB_INIT_CMD_SET_INVERTED,
	CFB_INIT_CMD_FILL,
	CFB_INIT_CMD_SET_COMMAND_BUFFER,
	NUM_OF_INIT_CMDS,
};

struct cfb_font {
	const void *data;
	enum cfb_font_caps caps;
	uint8_t width;
	uint8_t height;
	uint8_t first_char;
	uint8_t last_char;
};

struct cfb_position {
	int16_t x;
	int16_t y;
};

/**
 * @brief CFB operation structure
 */
struct cfb_command_param {
	union {
		/**
		 * @brief Parameter for CFB_OP_INVERT_AREA operation
		 */
		struct {
			int16_t x;
			int16_t y;
			uint16_t w;
			uint16_t h;
		} invert_area;

		/**
		 * @brief Parameter for CFB_OP_DRAW_POINT, CFB_OP_DRAW_LINE
		 *        and CFB_DRAW_RECT operation
		 */
		struct {
			struct cfb_position start;
			struct cfb_position end;
		} draw_figure;

		/**
		 * @brief Parameter for CFB_OP_PRINT and CFB_OP_DRAW_TEXT
		 *        operation
		 */
		struct {
			const char *str;
			struct cfb_position pos;
		} draw_text;

		/**
		 * @brief Parameter for CFB_OP_SET_FONT operation
		 */
		struct {
			uint8_t font_idx;
		} set_font;

		/**
		 * @brief Parameter for CFB_OP_SET_KERNING operation
		 */
		struct {
			int8_t kerning;
		} set_kerning;

		struct {
			bool inverted;
		} set_inverted;
		/**
		 * @brief Parameter for CFB_OP_SET_COMMAND_BUFFER
		 */
		struct {
			struct cfb_commandbuffer *cmdbuf;
		} cmd_buffer;
	};

	/** Type of operation */
	uint8_t op;
} __packed;

struct cfb_command {
	/** Linked-list node */
	sys_snode_t node;
	struct cfb_command_param param;
};

/**
 * A framebuffer definition in CFB.
 *
 * This is a private definition.
 * Don't access directly to members of this structure.
 */
struct cfb_framebuffer {
	/** Pointer to a buffer in RAM */
	uint8_t *buf;

	/** Size of the framebuffer */
	uint32_t size;

	/** Display pixel format */
	enum display_pixel_format pixel_format;

	/** Display screen info */
	enum display_screen_info screen_info;

	/** Framebuffer width in pixels */
	uint16_t width;

	/** Framebuffer height in pixels */
	uint16_t height;

	/** Number of pixels per tile, typically 8 */
	uint8_t ppt;

	/**
	 * @param disp Pointer to display instance
	 * @return 0 on success, negative value otherwise
	 */
	int (*finalize)(const struct cfb_framebuffer *disp, int16_t x, int16_t y, uint16_t width,
			uint16_t height);

	/**
	 * @param disp Pointer to display instance
	 * @param clear_display Clear the display as well
	 * @return 0 on success, negative value otherwise
	 */
	int (*clear)(const struct cfb_framebuffer *disp, bool clear_display);

	/**
	 * @param disp Pointer to display instance
	 * @param cmd Pointer to command for append to the list
	 * @param append_buffer Store in buffer if true
	 * @return 0 on success, negative value otherwise
	 */
	int (*append_command)(const struct cfb_framebuffer *disp, struct cfb_command *cmd,
			      bool append_buffer);

	/**
	 * @param disp Pointer to display instance
	 * @param x x-position of transfer region
	 * @param y y-position of transfer region
	 * @param w width of transfer region
	 * @param h height of transfer region
	 */
	int (*transfer_buffer)(const struct cfb_framebuffer *disp, int16_t x, int16_t y, uint16_t w,
			       uint16_t h);
};

/**
 * CFB command buffer .
 *
 * This is a private definition.
 * Don't access directly to members of this structure.
 */
struct cfb_commandbuffer {
	/** Pointer to a buffer */
	uint8_t *buf;

	/** Size of the commandbuffer*/
	uint32_t size;

	/** Current position of buffer */
	size_t pos;
};

/**
 * A display definition in CFB.
 *
 * This is a private definition.
 * Don't access directly to members of this structure.
 */
struct cfb_display {
	/** Framebuffer */
	struct cfb_framebuffer fb;

	/** Command buffer */
	struct cfb_commandbuffer cmdbuf;

	/** Pointer to device */
	const struct device *dev;

	/** Resolution of a framebuffer in pixels in X direction */
	uint16_t x_res;

	/** Resolution of a framebuffer in pixels in Y direction */
	uint16_t y_res;

	/** Current font index */
	uint8_t font_idx;

	/** Current font kerning */
	int8_t kerning;

	/** Inverted */
	bool inverted;

	/** Linked list for queueing commands */
	sys_slist_t cmd_list;

	/**  Variable for storing commands that are used every time rendering initializing */
	struct cfb_command init_cmds[NUM_OF_INIT_CMDS];
};

/**
 * @brief Append command to list
 *
 * Append command to list. Execute commands in the list at finalizing.
 *
 * @param fb Pointer to framebuffer to rendering
 * @param cmd Pointer to command for append to the list
 *
 * @retval 0 on success
 * @retval -errno Negative errno for other failures.
 */
static inline int cfb_append_command(const struct cfb_framebuffer *fb, struct cfb_command *cmd)
{
	return fb->append_command(fb, cmd, false);
}

/**
 * @brief Print a string into the framebuffer.
 *
 * This function copies the argument string into a buffer.
 * The argument string can be discarded immediately, but it uses buffer memory.
 *
 * This function simply stores the drawing command in the buffer,
 * and the actual drawing will be done when cfb_finalize is executed.
 *
 * @param fb Pointer to framebuffer to rendering
 * @param str String to print
 * @param x Position in X direction of the beginning of the string
 * @param y Position in Y direction of the beginning of the string
 *
 * @retval 0 on success
 * @retval -ENOBUFS The command buffer does not have enough space
 * @retval -errno Negative errno for other failures.
 */
static inline int cfb_print(const struct cfb_framebuffer *fb, const char *const str, int16_t x,
			    int16_t y)
{
	struct cfb_command cmd = CFB_OP_INIT_PRINT(str, x, y);

	return fb->append_command(fb, &cmd, true);
}

/**
 * @brief Print a string reference into the framebuffer.
 *
 * This function copies the argument string into a buffer.
 * The argument string can be discarded immediately, but it uses buffer memory.
 *
 * This function simply stores the drawing command in the buffer,
 * and the actual drawing will be done when cfb_finalize is executed.
 *
 * @param fb Pointer to framebuffer to rendering
 * @param str String to print
 * @param x Position in X direction of the beginning of the string
 * @param y Position in Y direction of the beginning of the string
 *
 * @retval 0 on success
 * @retval -ENOBUFS The command buffer does not have enough space
 * @retval -errno Negative errno for other failures.
 */
static inline int cfb_print_ref(const struct cfb_framebuffer *fb, const char *const str, int16_t x,
				int16_t y)
{
	struct cfb_command cmd = CFB_OP_INIT_PRINT_REF(str, x, y);

	return fb->append_command(fb, &cmd, true);
}

/**
 * @brief Print a string into the framebuffer.
 * For compare to cfb_print, cfb_draw_text accept non tile-aligned coords
 * and not line wrapping.
 *
 * This function copies the argument string into a buffer.
 * The argument string can be discarded immediately, but it uses buffer memory.
 *
 * This function simply stores the drawing command in the buffer,
 * and the actual drawing will be done when cfb_finalize is executed.
 *
 * @param fb Pointer to framebuffer to rendering
 * @param str String to print
 * @param x Position in X direction of the beginning of the string
 * @param y Position in Y direction of the beginning of the string
 *
 * @retval 0 on success
 * @retval -ENOBUFS The command buffer does not have enough space
 * @retval -errno Negative errno for other failures.
 */
static inline int cfb_draw_text(const struct cfb_framebuffer *fb, const char *const str, int16_t x,
				int16_t y)
{
	struct cfb_command cmd = CFB_OP_INIT_DRAW_TEXT(str, x, y);

	return fb->append_command(fb, &cmd, true);
}

/**
 * @brief Print a string reference into the framebuffer.
 * For compare to cfb_print, cfb_draw_text accept non tile-aligned coords
 * and not line wrapping.
 *
 * This function copies the argument string into a buffer.
 * The argument string can be discarded immediately, but it uses buffer memory.
 *
 * This function simply stores the drawing command in the buffer,
 * and the actual drawing will be done when cfb_finalize is executed.
 *
 * @param fb Pointer to framebuffer to rendering
 * @param str String to print
 * @param x Position in X direction of the beginning of the string
 * @param y Position in Y direction of the beginning of the string
 *
 * @retval 0 on success
 * @retval -ENOBUFS The command buffer does not have enough space
 * @retval -errno Negative errno for other failures.
 */
static inline int cfb_draw_text_ref(const struct cfb_framebuffer *fb, const char *const str,
				    int16_t x, int16_t y)
{
	struct cfb_command cmd = CFB_OP_INIT_DRAW_TEXT_REF(str, x, y);

	return fb->append_command(fb, &cmd, true);
}

/**
 * @brief Draw a point.
 *
 * Draw a point to specified coordination.
 *
 * This function simply stores the drawing command in the buffer,
 * and the actual drawing will be done when cfb_finalize is executed.
 *
 * @param fb Pointer to framebuffer to rendering
 * @param pos Position of the point
 *
 * @retval 0 on success
 * @retval -ENOBUFS The command buffer does not have enough space
 * @retval -errno Negative errno for other failures.
 */
static inline int cfb_draw_point(const struct cfb_framebuffer *fb, const struct cfb_position *pos)
{
	struct cfb_command cmd = CFB_OP_INIT_DRAW_POINT(str, *pos);

	return fb->append_command(fb, &cmd, true);
}

/**
 * @brief Draw a line.
 *
 * Draw a line between specified two points.
 *
 * This function simply stores the drawing command in the buffer,
 * and the actual drawing will be done when cfb_finalize is executed.
 *
 * @param fb Pointer to framebuffer to rendering
 * @param start Start position of the line
 * @param end End position of the line
 *
 * @retval 0 on success
 * @retval -ENOBUFS The command buffer does not have enough space
 * @retval -errno Negative errno for other failures.
 */
static inline int cfb_draw_line(const struct cfb_framebuffer *fb, const struct cfb_position *start,
				const struct cfb_position *end)
{
	struct cfb_command cmd = CFB_OP_INIT_DRAW_LINE(str, *start, *end);

	return fb->append_command(fb, &cmd, true);
}

/**
 * @brief Draw a rectangle.
 *
 * Draw a rectangle that formed by specified start and end points.
 *
 * This function simply stores the drawing command in the buffer,
 * and the actual drawing will be done when cfb_finalize is executed.
 *
 * @param fb Pointer to framebuffer to rendering
 * @param start Top-Left position of the rectangle
 * @param end Bottom-Right position of the rectangle
 *
 * @retval 0 on success
 * @retval -ENOBUFS The command buffer does not have enough space
 * @retval -errno  Negative errno for other failures.
 */
static inline int cfb_draw_rect(const struct cfb_framebuffer *fb, const struct cfb_position *start,
				const struct cfb_position *end)
{
	struct cfb_command cmd = CFB_OP_INIT_DRAW_RECT(str, *start, *end);

	return fb->append_command(fb, &cmd, true);
}

/**
 * @brief Clear command buffer and framebuffer.
 *
 * @param fb Pointer to framebuffer to rendering
 * @param clear_display Clear the display as well
 *
 * @retval 0 on success
 * @retval -errno  Negative errno for other failures.
 */
static inline int cfb_clear(const struct cfb_framebuffer *fb, bool clear_display)
{
	return fb->clear(fb, clear_display);
}

/**
 * @brief Invert Pixels.
 *
 * @param fb Pointer to framebuffer to rendering
 *
 * @return 0 on success, negative value otherwise
 */
static inline int cfb_invert(const struct cfb_framebuffer *fb)
{
	struct cfb_command cmd = CFB_OP_INIT_INVERT();

	return fb->append_command(fb, &cmd, true);
}

/**
 * @brief Invert Pixels in selected area.
 *
 * @param fb Pointer to framebuffer to rendering
 * @param x Position in X direction of the beginning of area
 * @param y Position in Y direction of the beginning of area
 * @param width Width of area in pixels
 * @param height Height of area in pixels
 *
 * @return 0 on success, negative value otherwise
 */
static inline int cfb_invert_area(const struct cfb_framebuffer *fb, int16_t x, int16_t y,
				  uint16_t width, uint16_t height)
{
	struct cfb_command cmd = CFB_OP_INIT_INVERT_AREA(x, y, width, height);

	return fb->append_command(fb, &cmd, true);
}

/**
 * @brief Finalize framebuffer.
 *
 * Execute commands and write image to display.
 * If the buffer is small, it will draw and transfer the screen multiple
 * times with the size of the buffer.
 * It will work with less buffer, but drawing will be slower.
 *
 * @param fb Pointer to framebuffer to rendering
 *
 * @return 0 on success, negative value otherwise
 */
static inline int cfb_finalize(const struct cfb_framebuffer *fb)
{
	return fb->finalize(fb, 0, 0, UINT16_MAX, UINT16_MAX);
}

static inline int cfb_finalize_area(const struct cfb_framebuffer *fb, int16_t x, int16_t y,
				    uint16_t width, uint16_t height)
{
	return fb->finalize(fb, x, y, width, height);
}

/**
 * @brief Get display parameter.
 *
 * @param disp Pointer to display instance
 * @param cfb_display_param One of the display parameters
 *
 * @return Display parameter value
 */
int cfb_get_display_parameter(const struct cfb_display *disp, enum cfb_display_param);

/**
 * @brief Set font.
 *
 * Select font that is used by cfb_draw_text and cfb_print for drawing.
 *
 * This function simply stores the drawing command in the buffer,
 * and the actual drawing will be done when cfb_finalize is executed.
 * The setting keeps even after finalize is executed.
 *
 * @param fb Pointer to framebuffer instance
 * @param idx Font index
 *
 * @retval 0 on success
 * @retval -ENOBUFS The command buffer does not have enough space
 * @retval -errno  Negative errno for other failures.
 */
static inline int cfb_set_font(const struct cfb_framebuffer *fb, uint8_t idx)
{
	struct cfb_command cmd = CFB_OP_INIT_SET_FONT(idx);

	return fb->append_command(fb, &cmd, true);
}

/**
 * @brief Set font kerning.
 *
 * Set spacing between individual letters.
 *
 * This function simply stores the drawing command in the buffer,
 * and the actual drawing will be done when cfb_finalize is executed.
 * The setting keeps even after finalize is executed.
 *
 * @param fb Pointer to framebuffer instance
 * @param kerning Spacing between each characters in pixels
 *
 * @retval 0 on success
 * @retval -ENOBUFS The command buffer does not have enough space
 * @retval -errno  Negative errno for other failures.
 */
static inline int cfb_set_kerning(const struct cfb_framebuffer *fb, int8_t kerning)
{
	struct cfb_command cmd = CFB_OP_INIT_SET_KERNING(kerning);

	return fb->append_command(fb, &cmd, true);
}

/**
 * @brief Get font size.
 *
 * Get width and height of font that is specified by idx.
 *
 * @param idx Font index
 * @param width Pointers to the variable where the font width will be stored.
 * @param height Pointers to the variable where the font height will be stored.
 *
 * @retval 0 on success
 * @retval -EINVAL If you specify idx for a font that does not exist
 */
int cfb_get_font_size(uint8_t idx, uint8_t *width, uint8_t *height);

/**
 * @brief Get number of fonts.
 *
 * @return number of fonts
 */
int cfb_get_numof_fonts(void);

/**
 * @brief Initialize display.
 *
 *
 * @param disp Pointer to cfb_display structure
 * @param dev Pointer to device that use to displaying
 * @param xferbuf Pointer to image transfer buffer
 * @param xferbuf_size Image transfer buffer size.
 *                     You must allocate at least 1 pixel of memory for the transfer buffer.
 *                     Buffers are used line by line. Allocating memory in multiples of.
 *                     the X-resolution eliminates waste.
 * @param cmdbuf Pointer to command buffer
 * @param cmdbuf_size Command buffer size.
 *                    If the command buffer is not allocated, the drawing API will
 *                    result in an error -ENOBUFS. Even in this case, you can use
 *                    cfb_command_append to draw with command variables managed
 *                    by the user.
 * @return 0 on success
 */
int cfb_display_init(struct cfb_display *disp, const struct device *dev, void *xferbuf,
		     size_t xferbuf_size, void *cmdbuf, size_t cmdbuf_size);

/**
 * @brief Allocate and initialize display object.
 *
 * @param dev Pointer to device that use to displaying
 * @param xferbuf_size Size of image transfer buffer to allocate
 * @param cmdbuf_size Size of command buffer to allocate
 *
 * @retval NULL If memory allocation failed.
 * @retval Non-NULL on success
 */
struct cfb_display *cfb_display_alloc(const struct device *dev, size_t xferbuf_size,
				      size_t cmdbuf_size);

/**
 * @brief Deinitialize Character Framebuffer.
 *
 * @param disp Pointer to display instance to deinitialize
 */
void cfb_display_deinit(struct cfb_display *disp);

/**
 * @brief Release allocated cfb_display object
 *
 * Release cfb_display object that allocated by
 * cfb_display_alloc_init.
 *
 * @param disp Pointer to display object that allocated by
 *             cfb_display_alloc_init.
 */
void cfb_display_free(struct cfb_display *disp);

/**
 * @brief Get framebuffer subordinate to cfb_display.
 *
 * @param disp Pointer to display instance to retrieve framebuffer.
 */
struct cfb_framebuffer *cfb_display_get_framebuffer(struct cfb_display *disp);

#ifdef __cplusplus
}
#endif

/**
 * @}
 */

#endif /* __CFB_H__ */
